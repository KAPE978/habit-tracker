<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Habits">
<meta name="theme-color" content="#0a0a0b">
<link rel="manifest" href="manifest.json">
<title>Habit Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,400&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0b;
  --surface: #111113;
  --surface2: #18181b;
  --surface3: #1e1e22;
  --border: #252528;
  --border2: #303035;
  --accent: #c8f04a;
  --accent-dim: rgba(200,240,74,0.12);
  --accent2: #4af0c8;
  --red: #f05a4a;
  --orange: #f0a04a;
  --yellow: #f0e04a;
  --text: #e2e2df;
  --muted: #4a4a50;
  --muted2: #6a6a72;
  --radius: 14px;
  --font-display: 'Bebas Neue', sans-serif;
  --font-mono: 'DM Mono', monospace;
}
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; overscroll-behavior: none; }
body { background: var(--bg); color: var(--text); font-family: var(--font-mono); overflow: hidden; display: flex; flex-direction: column; }

/* â”€â”€ TOPBAR â”€â”€ */
.topbar {
  padding: max(env(safe-area-inset-top), 10px) 18px 10px;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  flex-shrink: 0; z-index: 50;
}
.topbar-left { display: flex; flex-direction: column; gap: 1px; }
.topbar-title { font-family: var(--font-display); font-size: 26px; letter-spacing: 1px; line-height: 1; color: var(--text); }
.topbar-title span { color: var(--accent); }
.topbar-date { font-size: 9px; color: var(--muted2); text-transform: uppercase; letter-spacing: 1.2px; }

/* â”€â”€ SCORE RING â”€â”€ */
.score-ring-wrap { display: flex; flex-direction: column; align-items: center; gap: 2px; }
.score-ring { position: relative; width: 54px; height: 54px; }
.score-ring svg { transform: rotate(-90deg); }
.score-ring .ring-bg { fill: none; stroke: var(--border2); stroke-width: 4; }
.score-ring .ring-fill { fill: none; stroke-width: 4; stroke-linecap: round; transition: stroke-dashoffset 0.6s cubic-bezier(.4,0,.2,1), stroke 0.4s; }
.score-ring .ring-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-family: var(--font-display); font-size: 16px; letter-spacing: 0.5px; }
.score-ring-label { font-size: 8px; color: var(--muted2); text-transform: uppercase; letter-spacing: 1px; }

/* â”€â”€ GRADE BADGE â”€â”€ */
.grade { font-family: var(--font-display); font-size: 13px; letter-spacing: 1px; padding: 2px 8px; border-radius: 5px; }
.grade-s { background: rgba(200,240,74,0.2); color: var(--accent); }
.grade-a { background: rgba(74,240,200,0.15); color: var(--accent2); }
.grade-b { background: rgba(240,224,74,0.15); color: var(--yellow); }
.grade-c { background: rgba(240,160,74,0.15); color: var(--orange); }
.grade-d { background: rgba(240,90,74,0.15); color: var(--red); }
.grade-f { background: rgba(240,74,74,0.1); color: #f07070; }

/* â”€â”€ STREAK BAR â”€â”€ */
.streak-bar {
  display: flex; align-items: center; justify-content: space-between;
  background: var(--surface); border-bottom: 1px solid var(--border);
  padding: 8px 18px; flex-shrink: 0; gap: 10px;
}
.streak-item { display: flex; align-items: center; gap: 6px; }
.streak-num { font-family: var(--font-display); font-size: 18px; color: var(--accent); letter-spacing: 0.5px; }
.streak-lbl { font-size: 8.5px; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.8px; }
.streak-divider { width: 1px; height: 22px; background: var(--border2); }
.live-score-label { font-size: 9px; color: var(--muted2); text-transform: uppercase; letter-spacing: 1px; }
.trend-indicator { font-size: 11px; }

/* â”€â”€ SCROLL â”€â”€ */
.scroll-area { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }

/* â”€â”€ MONTH HEADER â”€â”€ */
.month-header { padding: 10px 18px 8px; background: var(--surface); border-bottom: 1px solid var(--border); border-top: 2px solid var(--border); font-family: var(--font-display); font-size: 16px; color: var(--accent); letter-spacing: 1px; position: sticky; top: 0; z-index: 20; display: flex; justify-content: space-between; align-items: center; }
.month-avg { font-family: var(--font-mono); font-size: 10px; }

/* â”€â”€ DAY CARD â”€â”€ */
.day-card { background: var(--bg); border-bottom: 1px solid var(--border); padding: 12px 18px; }
.day-card.weekend { background: rgba(255,255,255,0.008); }
.day-card.today { background: rgba(200,240,74,0.04); border-left: 3px solid var(--accent); }
.day-card.missed { border-left: 3px solid rgba(240,90,74,0.3); }
.day-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.day-info { display: flex; align-items: center; gap: 10px; }
.day-name-text { font-size: 13px; }
.day-sub { font-size: 9px; color: var(--muted2); }
.day-score-pill { font-size: 10px; font-weight: 500; padding: 3px 9px; border-radius: 20px; border: 1px solid var(--border); transition: all 0.2s; white-space: nowrap; }
.s0 { color: var(--muted); }
.s1,.s2 { color: var(--red); border-color: rgba(240,90,74,0.3); }
.s3,.s4 { color: var(--orange); border-color: rgba(240,160,74,0.3); }
.s5,.s6 { color: var(--yellow); border-color: rgba(240,224,74,0.3); }
.s7 { color: var(--accent); border-color: var(--accent); background: var(--accent-dim); }

/* â”€â”€ HABIT GRID â”€â”€ */
.habit-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 7px; }
.habit-toggle { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 9px 5px; background: var(--surface); border-radius: 10px; cursor: pointer; border: 1.5px solid var(--border); transition: all 0.12s; user-select: none; -webkit-user-select: none; position: relative; }
.habit-toggle.checked { background: var(--accent-dim); border-color: var(--accent); }
.habit-toggle .emoji { font-size: 18px; line-height: 1; }
.habit-toggle .hlabel { font-size: 7.5px; color: var(--muted2); text-align: center; text-transform: uppercase; letter-spacing: 0.3px; line-height: 1.3; }
.habit-toggle.checked .hlabel { color: var(--accent); }
.habit-toggle .htick { position: absolute; top: 4px; right: 5px; font-size: 8px; opacity: 0; color: var(--accent); }
.habit-toggle.checked .htick { opacity: 1; }
.habit-toggle:active { transform: scale(0.94); }

/* â”€â”€ VIEWS â”€â”€ */
.view { display: none; flex: 1; flex-direction: column; overflow: hidden; }
.view.active { display: flex; }

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bottom-nav { display: flex; background: var(--surface); border-top: 1px solid var(--border); padding-bottom: env(safe-area-inset-bottom, 0px); flex-shrink: 0; }
.nav-btn { flex: 1; padding: 11px 4px; font-size: 8px; color: var(--muted); cursor: pointer; border: none; background: none; font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.8px; display: flex; flex-direction: column; align-items: center; gap: 3px; transition: color 0.15s; }
.nav-btn .nav-icon { font-size: 16px; }
.nav-btn.active { color: var(--accent); }

/* â”€â”€ CONTENT PAGES â”€â”€ */
.page-content { flex: 1; overflow-y: auto; padding: 18px; -webkit-overflow-scrolling: touch; }
.section-title { font-family: var(--font-display); font-size: 13px; letter-spacing: 1.5px; color: var(--muted2); margin-bottom: 12px; text-transform: uppercase; }

/* â”€â”€ BIG SCORE CARD â”€â”€ */
.score-hero {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 18px;
}
.score-hero-ring { flex-shrink: 0; }
.score-hero-info { flex: 1; }
.score-hero-pct { font-family: var(--font-display); font-size: 48px; letter-spacing: 2px; line-height: 1; }
.score-hero-label { font-size: 9px; color: var(--muted2); text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
.score-hero-sub { font-size: 10px; color: var(--muted2); margin-top: 8px; line-height: 1.6; }

/* â”€â”€ MINI STAT GRID â”€â”€ */
.mini-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
.mini-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 12px 10px; text-align: center; }
.mini-num { font-family: var(--font-display); font-size: 22px; color: var(--accent); letter-spacing: 0.5px; }
.mini-lbl { font-size: 8px; color: var(--muted2); text-transform: uppercase; letter-spacing: 0.8px; margin-top: 3px; }

/* â”€â”€ HABIT BREAKDOWN â”€â”€ */
.habit-rows { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
.habit-row { background: var(--surface); border-radius: 10px; padding: 11px 14px; border: 1px solid var(--border); }
.habit-row-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.habit-row-name { font-size: 11px; }
.habit-row-pct { font-size: 11px; color: var(--accent); }
.pbar { height: 3px; background: var(--border2); border-radius: 2px; overflow: hidden; }
.pfill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.5s ease; }

/* â”€â”€ NOTIF CARD â”€â”€ */
.notif-card { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; margin-bottom: 18px; }
.card-title { font-size: 12px; margin-bottom: 8px; color: var(--text); }
.card-sub { font-size: 10px; color: var(--muted2); margin-bottom: 14px; line-height: 1.6; }
.notif-status { font-size: 9px; padding: 3px 9px; border-radius: 5px; display: inline-block; margin-bottom: 12px; }
.ns-on { background: rgba(200,240,74,0.15); color: var(--accent); border: 1px solid var(--accent); }
.ns-off { background: rgba(240,90,74,0.1); color: var(--red); border: 1px solid var(--red); }
.row { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
.row label { font-size: 10px; color: var(--muted2); flex: 1; }
.time-input { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: var(--font-mono); font-size: 12px; padding: 7px 10px; width: 120px; outline: none; }
.btn { border: none; border-radius: 10px; padding: 10px 16px; font-family: var(--font-mono); font-size: 11px; font-weight: 500; cursor: pointer; transition: all 0.12s; letter-spacing: 0.3px; }
.btn-accent { background: var(--accent); color: #0a0a0b; }
.btn-outline { background: transparent; color: var(--text); border: 1px solid var(--border); }
.btn:active { transform: scale(0.96); }
.btn-row { display: flex; gap: 8px; flex-wrap: wrap; }

/* â”€â”€ WORKOUT â”€â”€ */
.day-tab-bar { display: flex; overflow-x: auto; padding: 10px 18px 0; gap: 6px; background: var(--surface); border-bottom: 1px solid var(--border); flex-shrink: 0; scrollbar-width: none; }
.day-tab-bar::-webkit-scrollbar { display: none; }
.day-tab { padding: 7px 14px; border-radius: 8px 8px 0 0; font-size: 10px; cursor: pointer; border: 1px solid var(--border); border-bottom: none; white-space: nowrap; color: var(--muted2); background: var(--bg); transition: all 0.12s; flex-shrink: 0; text-transform: uppercase; letter-spacing: 0.5px; }
.day-tab.active { color: var(--accent); border-color: var(--accent); background: var(--bg); }
.day-tab.today-tab { color: var(--accent2); }
.workout-content { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
.workout-day-panel { display: none; padding: 18px; }
.workout-day-panel.active { display: block; }
.wday-title { font-family: var(--font-display); font-size: 24px; letter-spacing: 1px; margin-bottom: 2px; }
.wday-sub { font-size: 9px; color: var(--muted2); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; }
.ex-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
.ex-item { background: var(--surface); border-radius: 11px; padding: 12px; border: 1px solid var(--border); display: flex; align-items: flex-start; gap: 10px; transition: opacity 0.2s; }
.ex-item.done-item { opacity: 0.5; }
.ex-check { width: 20px; height: 20px; border: 1.5px solid var(--border2); border-radius: 5px; flex-shrink: 0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 11px; transition: all 0.12s; margin-top: 1px; }
.ex-check.done { background: var(--accent); border-color: var(--accent); color: #0a0a0b; }
.ex-body { flex: 1; min-width: 0; }
.ex-name { font-size: 12px; word-break: break-word; }
.ex-name.done-text { text-decoration: line-through; color: var(--muted2); }
.ex-detail { font-size: 9px; color: var(--muted2); margin-top: 2px; }
.ex-del { color: var(--muted); font-size: 17px; cursor: pointer; padding: 0 2px; line-height: 1; flex-shrink: 0; }
.add-ex-row { display: flex; gap: 8px; margin-bottom: 14px; }
.ex-input { background: var(--surface); border: 1px solid var(--border); border-radius: 9px; color: var(--text); font-family: var(--font-mono); font-size: 11px; padding: 9px 12px; flex: 1; min-width: 0; outline: none; }
.ex-input:focus { border-color: var(--accent); }
.ex-input::placeholder { color: var(--muted); }
.rest-toggle { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 12px; text-align: center; cursor: pointer; font-size: 11px; color: var(--muted2); transition: all 0.2s; margin-bottom: 14px; }
.rest-toggle.rest { background: rgba(74,240,200,0.07); border-color: var(--accent2); color: var(--accent2); }
.clear-done-btn { width: 100%; padding: 10px; background: transparent; border: 1px dashed var(--border); border-radius: 9px; color: var(--muted); font-family: var(--font-mono); font-size: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; }

/* â”€â”€ SKILLS â”€â”€ */
.skills-content { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 18px; }

/* Period selector */
.period-scroll { display: flex; overflow-x: auto; gap: 8px; margin-bottom: 18px; padding-bottom: 4px; scrollbar-width: none; }
.period-scroll::-webkit-scrollbar { display: none; }
.period-chip { flex-shrink: 0; padding: 7px 14px; border-radius: 20px; font-size: 10px; border: 1px solid var(--border); color: var(--muted2); cursor: pointer; transition: all 0.15s; text-transform: uppercase; letter-spacing: 0.5px; background: var(--surface); white-space: nowrap; }
.period-chip.active { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }
.period-chip.current-period { border-color: var(--accent2); color: var(--accent2); }

/* Period hero */
.period-hero { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; margin-bottom: 16px; }
.period-hero-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 10px; }
.period-hero-title { font-family: var(--font-display); font-size: 20px; letter-spacing: 0.5px; }
.period-hero-dates { font-size: 9px; color: var(--muted2); margin-top: 3px; }
.period-hero-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
.period-pct { font-family: var(--font-display); font-size: 28px; color: var(--accent); letter-spacing: 1px; }
.period-days-left { font-size: 9px; color: var(--muted2); text-align: right; }
.period-progress { height: 5px; background: var(--border2); border-radius: 3px; overflow: hidden; margin-top: 4px; }
.period-fill { height: 100%; background: linear-gradient(90deg, var(--accent2), var(--accent)); border-radius: 3px; transition: width 0.5s; }

/* Add skill */
.add-skill-row { display: flex; gap: 8px; margin-bottom: 16px; }
.skill-main-input { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-family: var(--font-mono); font-size: 12px; padding: 10px 14px; flex: 1; outline: none; }
.skill-main-input:focus { border-color: var(--accent); }
.skill-main-input::placeholder { color: var(--muted); }

/* Skill card */
.skill-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 12px; overflow: hidden; }
.skill-card-header { padding: 14px 16px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
.skill-card-check { width: 22px; height: 22px; border: 1.5px solid var(--border2); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; transition: all 0.15s; cursor: pointer; }
.skill-card-check.done { background: var(--accent); border-color: var(--accent); color: #0a0a0b; }
.skill-card-info { flex: 1; min-width: 0; }
.skill-card-name { font-size: 13px; word-break: break-word; }
.skill-card-name.done-text { text-decoration: line-through; color: var(--muted2); }
.skill-card-meta { font-size: 9px; color: var(--muted2); margin-top: 2px; }
.skill-card-right { display: flex; align-items: center; gap: 8px; }
.skill-subtask-count { font-size: 9px; color: var(--muted2); }
.skill-expand { font-size: 12px; color: var(--muted2); transition: transform 0.2s; }
.skill-expand.open { transform: rotate(180deg); }
.skill-del { color: var(--muted); font-size: 16px; cursor: pointer; padding: 2px; }

/* Subtasks */
.subtask-section { border-top: 1px solid var(--border); padding: 12px 16px; display: none; }
.subtask-section.open { display: block; }
.subtask-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
.subtask-item { display: flex; align-items: center; gap: 10px; padding: 8px 10px; background: var(--surface2); border-radius: 8px; border: 1px solid var(--border); }
.st-check { width: 18px; height: 18px; border: 1.5px solid var(--border2); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; flex-shrink: 0; cursor: pointer; transition: all 0.12s; }
.st-check.done { background: var(--accent); border-color: var(--accent); color: #0a0a0b; }
.st-text { flex: 1; font-size: 11px; word-break: break-word; }
.st-text.done-text { text-decoration: line-through; color: var(--muted2); }
.st-del { color: var(--muted); font-size: 15px; cursor: pointer; flex-shrink: 0; }
.add-subtask-row { display: flex; gap: 6px; }
.st-input { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: var(--font-mono); font-size: 11px; padding: 7px 10px; flex: 1; outline: none; }
.st-input:focus { border-color: var(--accent); }
.st-input::placeholder { color: var(--muted); }
.st-add-btn { background: var(--accent-dim); border: 1px solid var(--accent); color: var(--accent); border-radius: 8px; font-family: var(--font-mono); font-size: 13px; padding: 6px 12px; cursor: pointer; }

/* LOAD MORE */
.load-more-btn { display: block; width: calc(100% - 36px); margin: 14px 18px; padding: 13px; background: var(--surface); border: 1px dashed var(--border); border-radius: 11px; color: var(--muted2); font-family: var(--font-mono); font-size: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: all 0.15s; }
.load-more-btn:hover { border-color: var(--accent); color: var(--accent); }

/* DIVIDER */
.divider { height: 1px; background: var(--border); margin: 16px 0; }

/* EMPTY STATE */
.empty-state { text-align: center; padding: 32px 20px; color: var(--muted2); font-size: 11px; line-height: 1.8; }
.empty-icon { font-size: 32px; margin-bottom: 10px; }
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-left">
    <div class="topbar-title">HABITS <span>âˆ</span></div>
    <div class="topbar-date" id="topbar-date"></div>
  </div>
  <div style="display:flex;align-items:center;gap:10px;">
    <div class="score-ring-wrap">
      <div class="score-ring">
        <svg width="54" height="54" viewBox="0 0 54 54">
          <circle class="ring-bg" cx="27" cy="27" r="22"/>
          <circle class="ring-fill" id="ring-fill" cx="27" cy="27" r="22" stroke-dasharray="138.2" stroke-dashoffset="138.2" stroke="var(--accent)"/>
        </svg>
        <div class="ring-text" id="ring-text">0%</div>
      </div>
      <div class="score-ring-label">Score</div>
    </div>
  </div>
</div>

<!-- STREAK BAR -->
<div class="streak-bar">
  <div class="streak-item"><div class="streak-num" id="sb-streak">0</div><div class="streak-lbl">Day Streak</div></div>
  <div class="streak-divider"></div>
  <div class="streak-item"><div class="streak-num" id="sb-perfect">0</div><div class="streak-lbl">Perfect Days</div></div>
  <div class="streak-divider"></div>
  <div class="streak-item"><div class="streak-num" id="sb-grade" style="font-size:14px">â€”</div><div class="streak-lbl">Grade</div></div>
  <div class="streak-divider"></div>
  <button style="background:var(--accent);color:#0a0a0b;border:none;border-radius:7px;padding:5px 12px;font-family:var(--font-mono);font-size:10px;cursor:pointer;letter-spacing:0.3px;" onclick="scrollToToday()">Today</button>
</div>

<!-- TRACKER VIEW -->
<div class="view active" id="view-tracker">
  <div class="scroll-area">
    <div id="tracker-list"></div>
    <button class="load-more-btn" onclick="loadMoreDays()">+ Load 30 More Days</button>
  </div>
</div>

<!-- WORKOUT VIEW -->
<div class="view" id="view-workout">
  <div class="day-tab-bar" id="day-tab-bar"></div>
  <div class="workout-content" id="workout-content"></div>
</div>

<!-- SKILLS VIEW -->
<div class="view" id="view-skills">
  <div class="skills-content">
    <div class="section-title">Skills Â· 3-Month Sprints</div>
    <div class="period-scroll" id="period-scroll"></div>
    <div id="period-panel"></div>
  </div>
</div>

<!-- STATS VIEW -->
<div class="view" id="view-stats">
  <div class="page-content">
    <!-- Score hero -->
    <div class="score-hero">
      <div class="score-hero-ring">
        <div class="score-ring" style="width:72px;height:72px;">
          <svg width="72" height="72" viewBox="0 0 72 72">
            <circle class="ring-bg" cx="36" cy="36" r="30" stroke-width="5"/>
            <circle class="ring-fill" id="stats-ring-fill" cx="36" cy="36" r="30" stroke-dasharray="188.5" stroke-dashoffset="188.5" stroke="var(--accent)" stroke-width="5"/>
          </svg>
          <div class="ring-text" id="stats-ring-text" style="font-size:20px">0%</div>
        </div>
      </div>
      <div class="score-hero-info">
        <div class="score-hero-pct" id="sh-pct">0%</div>
        <div style="display:flex;align-items:center;gap:8px;margin-top:4px;">
          <span class="grade grade-f" id="sh-grade">F</span>
          <span class="live-score-label">Overall Grade</span>
        </div>
        <div class="score-hero-sub" id="sh-sub">Start checking habits to build your score.</div>
      </div>
    </div>

    <div class="mini-stats">
      <div class="mini-card"><div class="mini-num" id="ms-days">0</div><div class="mini-lbl">Days Logged</div></div>
      <div class="mini-card"><div class="mini-num" id="ms-perfect">0</div><div class="mini-lbl">Perfect</div></div>
      <div class="mini-card"><div class="mini-num" id="ms-streak">0</div><div class="mini-lbl">Best Streak</div></div>
    </div>

    <div class="section-title">Habit Breakdown</div>
    <div class="habit-rows" id="habit-rows"></div>

    <div class="section-title">Notifications</div>
    <div class="notif-card">
      <div class="card-title">ğŸ”” Daily Reminder</div>
      <div class="card-sub">Get notified every day to fill in your habits.</div>
      <div class="notif-status ns-off" id="notif-status">Off</div>
      <div class="row"><label>Remind me at</label><input type="time" class="time-input" id="notif-time" value="21:00"></div>
      <div class="btn-row">
        <button class="btn btn-accent" onclick="enableNotifications()">Enable</button>
        <button class="btn btn-outline" onclick="testNotification()">Test Now</button>
      </div>
    </div>
  </div>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <button class="nav-btn active" id="nav-tracker" onclick="switchView('tracker')"><span class="nav-icon">ğŸ“‹</span>Tracker</button>
  <button class="nav-btn" id="nav-workout" onclick="switchView('workout')"><span class="nav-icon">ğŸ’ª</span>Workout</button>
  <button class="nav-btn" id="nav-skills" onclick="switchView('skills')"><span class="nav-icon">ğŸ§ </span>Skills</button>
  <button class="nav-btn" id="nav-stats" onclick="switchView('stats')"><span class="nav-icon">ğŸ“Š</span>Stats</button>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTANTS & CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const HABITS = [
  { key:'exercise', emoji:'ğŸ‹ï¸', label:'Exercise' },
  { key:'nomusic',  emoji:'ğŸ”‡', label:'No Music' },
  { key:'water',    emoji:'ğŸ’§', label:'4L Water' },
  { key:'nosugar',  emoji:'ğŸš«ğŸ¬', label:'No Sugar' },
  { key:'nosocial', emoji:'ğŸ“µ', label:'No Social' },
  { key:'sleep',    emoji:'ğŸ˜´', label:'8h Sleep' },
  { key:'noproc',   emoji:'ğŸ¥—', label:'No Junk' },
];
const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
const MSHORT=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const DSHORT=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const DFULL=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

const SK='habits_v3', WK='workout_v3', NK='notif_v3', SKILLS_K='skills_v3';
const START = new Date(2026,5,1);

let habitData={}, workoutData={}, notifSettings={enabled:false,time:'21:00'}, skillsData={};
try{habitData=JSON.parse(localStorage.getItem(SK)||'{}');}catch(e){}
try{workoutData=JSON.parse(localStorage.getItem(WK)||'{}');}catch(e){}
try{notifSettings={...notifSettings,...JSON.parse(localStorage.getItem(NK)||'{}');};}catch(e){}
try{skillsData=JSON.parse(localStorage.getItem(SKILLS_K)||'{}');}catch(e){}

const saveH=()=>localStorage.setItem(SK,JSON.stringify(habitData));
const saveW=()=>localStorage.setItem(WK,JSON.stringify(workoutData));
const saveN=()=>localStorage.setItem(NK,JSON.stringify(notifSettings));
const saveS=()=>localStorage.setItem(SKILLS_K,JSON.stringify(skillsData));

const today=new Date();
const todayKey=fmtKey(today.getFullYear(),today.getMonth(),today.getDate());
const todayDow=today.getDay();

// Update topbar date
document.getElementById('topbar-date').textContent=today.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'}).toUpperCase();

function fmtKey(y,m,d){return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORE CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Score = (total checks completed) / (total possible checks for all PAST days including today)
// Unchecked past days pull the score down

function calcScore(){
  let totalPossible=0, totalDone=0, streak=0, maxStreak=0, perfect=0, daysLogged=0;
  const cur=new Date(START);
  const todayMidnight=new Date(today); todayMidnight.setHours(23,59,59,999);
  while(cur<=todayMidnight){
    if(cur.getDay()!==0){ // Sundays don't count
      const k=fmtKey(cur.getFullYear(),cur.getMonth(),cur.getDate());
      totalPossible+=7;
      const count=HABITS.filter(h=>(habitData[k]||{})[h.key]).length;
      totalDone+=count;
      if(count>0) daysLogged++;
      if(count===7){perfect++;streak++;maxStreak=Math.max(maxStreak,streak);}
      else streak=0;
    }
    cur.setDate(cur.getDate()+1);
  }
  const pct=totalPossible>0?Math.round(totalDone/totalPossible*100):0;
  return {pct,maxStreak,streak,perfect,daysLogged,totalDone,totalPossible};
}

function gradeFromPct(p){
  if(p>=95) return {label:'S',cls:'grade-s'};
  if(p>=85) return {label:'A',cls:'grade-a'};
  if(p>=70) return {label:'B',cls:'grade-b'};
  if(p>=55) return {label:'C',cls:'grade-c'};
  if(p>=40) return {label:'D',cls:'grade-d'};
  return {label:'F',cls:'grade-f'};
}

function ringColor(p){
  if(p>=85) return 'var(--accent)';
  if(p>=70) return 'var(--accent2)';
  if(p>=55) return 'var(--yellow)';
  if(p>=40) return 'var(--orange)';
  return 'var(--red)';
}

function updateTopScore(){
  const {pct,maxStreak,streak,perfect}=calcScore();
  const grade=gradeFromPct(pct);
  // Ring
  const circumference=138.2;
  const offset=circumference-(pct/100*circumference);
  const rf=document.getElementById('ring-fill');
  rf.style.strokeDashoffset=offset;
  rf.style.stroke=ringColor(pct);
  document.getElementById('ring-text').textContent=pct+'%';
  document.getElementById('ring-text').style.color=ringColor(pct);
  // Streak bar
  document.getElementById('sb-streak').textContent=streak;
  document.getElementById('sb-perfect').textContent=perfect;
  const gradeEl=document.getElementById('sb-grade');
  gradeEl.textContent=grade.label;
  gradeEl.className='streak-num grade '+grade.cls;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRACKER â€” infinite scroll
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let renderedTo=new Date(today); renderedTo.setDate(renderedTo.getDate()+7);
let lastRenderedMonth=-1;
const trackerList=document.getElementById('tracker-list');

function renderDays(from,to){
  let c=new Date(from);
  while(c<=to){
    const y=c.getFullYear(),m=c.getMonth(),d=c.getDate(),dow=c.getDay();
    const key=fmtKey(y,m,d);
    const isPast=c<today;
    const isToday=key===todayKey;
    if(m!==lastRenderedMonth){
      lastRenderedMonth=m;
      // calc month avg
      const mh=document.createElement('div');
      mh.className='month-header';
      mh.innerHTML=`<span>${MONTHS[m]} ${y}</span><span class="month-avg" id="mavg-${y}-${m}"></span>`;
      trackerList.appendChild(mh);
      updateMonthAvg(y,m);
    }
    const card=document.createElement('div');
    const dayData=habitData[key]||{};
    const count=HABITS.filter(h=>dayData[h.key]).length;
    const isMissed=isPast&&!isToday&&count===0&&dow!==0; // Sundays never marked as missed
    card.className='day-card'+(dow===0||dow===6?' weekend':'')+(isToday?' today':'')+(isMissed?' missed':'');
    card.id=`card-${key}`;
    card.innerHTML=`
      <div class="day-top">
        <div class="day-info">
          <div><div class="day-name-text">${String(d).padStart(2,'0')} ${MSHORT[m]} ${y}</div><div class="day-sub">${DSHORT[dow]}${isToday?' Â· TODAY':''}</div></div>
        </div>
        <div class="day-score-pill s${count}" id="score-${key}">${count}/7</div>
      </div>
      <div class="habit-grid" id="grid-${key}"></div>`;
    trackerList.appendChild(card);
    const grid=card.querySelector(`#grid-${key}`);
    HABITS.forEach(h=>{
      const btn=document.createElement('div');
      btn.className='habit-toggle'+(dayData[h.key]?' checked':'');
      btn.innerHTML=`<span class="htick">âœ“</span><span class="emoji">${h.emoji}</span><span class="hlabel">${h.label}</span>`;
      btn.addEventListener('click',()=>{
        if(!habitData[key]) habitData[key]={};
        habitData[key][h.key]=!habitData[key][h.key];
        btn.classList.toggle('checked',habitData[key][h.key]);
        saveH(); refreshDayScore(key,y,m); updateTopScore();
      });
      grid.appendChild(btn);
    });
    c.setDate(c.getDate()+1);
  }
}

function loadMoreDays(){
  const from=new Date(renderedTo); from.setDate(from.getDate()+1);
  const to=new Date(renderedTo); to.setDate(to.getDate()+30);
  renderDays(from,to); renderedTo=to;
}

function refreshDayScore(key,y,m){
  const count=HABITS.filter(h=>(habitData[key]||{})[h.key]).length;
  const el=document.getElementById(`score-${key}`);
  if(el){el.textContent=`${count}/7`; el.className=`day-score-pill s${count}`;}
  updateMonthAvg(y,m);
}

function updateMonthAvg(y,m){
  const el=document.getElementById(`mavg-${y}-${m}`);
  if(!el) return;
  const daysInMonth=new Date(y,m+1,0).getDate();
  let total=0,possible=0;
  const todayMidnight=new Date(today); todayMidnight.setHours(23,59,59);
  for(let d2=1;d2<=daysInMonth;d2++){
    const dt=new Date(y,m,d2);
    if(dt>todayMidnight) break;
    if(dt.getDay()===0) continue; // Sundays don't count
    const k=fmtKey(y,m,d2);
    possible+=7;
    total+=HABITS.filter(h=>(habitData[k]||{})[h.key]).length;
  }
  if(possible===0){el.textContent='';return;}
  const pct=Math.round(total/possible*100);
  const g=gradeFromPct(pct);
  el.innerHTML=`<span class="grade ${g.cls}" style="font-size:11px;">${pct}% Â· ${g.label}</span>`;
}

function scrollToToday(){
  switchView('tracker');
  setTimeout(()=>{
    const el=document.getElementById(`card-${todayKey}`);
    if(el) el.scrollIntoView({behavior:'smooth',block:'center'});
  },50);
}

renderDays(START,renderedTo);
updateTopScore();
setTimeout(()=>scrollToToday(),400);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStatsView(){
  const{pct,maxStreak,perfect,daysLogged,totalDone,totalPossible,streak}=calcScore();
  const grade=gradeFromPct(pct);
  const color=ringColor(pct);

  // Big ring
  const circ=188.5;
  const rf=document.getElementById('stats-ring-fill');
  rf.style.strokeDashoffset=circ-(pct/100*circ);
  rf.style.stroke=color;
  document.getElementById('stats-ring-text').textContent=pct+'%';
  document.getElementById('stats-ring-text').style.color=color;

  document.getElementById('sh-pct').textContent=pct+'%';
  document.getElementById('sh-pct').style.color=color;
  const ge=document.getElementById('sh-grade');
  ge.textContent=grade.label; ge.className='grade '+grade.cls;

  const missed=totalPossible/7-daysLogged;
  document.getElementById('sh-sub').textContent=
    `${totalDone} checks across ${daysLogged} days. ${missed>0?missed+' day'+(missed>1?'s':'')+' with no activity drag your score down.':'Every tracked day has at least one check!'}`;

  document.getElementById('ms-days').textContent=daysLogged;
  document.getElementById('ms-perfect').textContent=perfect;
  document.getElementById('ms-streak').textContent=maxStreak;

  // Habit breakdown
  const hr=document.getElementById('habit-rows');
  hr.innerHTML='';
  const allPastDays=[];
  const c=new Date(START);
  const todayM=new Date(today); todayM.setHours(23,59,59);
  while(c<=todayM){
    if(c.getDay()!==0) allPastDays.push(fmtKey(c.getFullYear(),c.getMonth(),c.getDate())); // skip Sundays
    c.setDate(c.getDate()+1);
  }
  HABITS.forEach(h=>{
    const cnt=allPastDays.filter(k=>(habitData[k]||{})[h.key]).length;
    const p=allPastDays.length>0?Math.round(cnt/allPastDays.length*100):0;
    hr.innerHTML+=`<div class="habit-row"><div class="habit-row-top"><span class="habit-row-name">${h.emoji} ${h.label}</span><span class="habit-row-pct">${p}%</span></div><div class="pbar"><div class="pfill" style="width:${p}%"></div></div></div>`;
  });

  // Notif
  const ns=document.getElementById('notif-status');
  if(notifSettings.enabled&&typeof Notification!=='undefined'&&Notification.permission==='granted'){
    ns.textContent=`âœ“ On Â· ${notifSettings.time} daily`; ns.className='notif-status ns-on';
  }else{ ns.textContent='Off'; ns.className='notif-status ns-off'; }
  document.getElementById('notif-time').value=notifSettings.time;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function enableNotifications(){
  if(!('Notification' in window)){alert('Notifications not supported. Try after installing as a home screen app.');return;}
  const perm=await Notification.requestPermission();
  if(perm==='granted'){
    notifSettings.enabled=true;
    notifSettings.time=document.getElementById('notif-time').value;
    saveN(); scheduleNotification(); renderStatsView();
    alert(`âœ… Reminder set for ${notifSettings.time} daily!`);
  }else{ alert('Permission denied. Enable in phone Settings > Safari/Chrome > Notifications.');}
}
function testNotification(){
  if(typeof Notification==='undefined'||Notification.permission!=='granted'){alert('Enable notifications first.');return;}
  new Notification('ğŸ‹ï¸ Habit Tracker',{body:"Don't forget to log today's habits!",icon:'icon.png'});
}
function scheduleNotification(){
  if(!notifSettings.enabled||typeof Notification==='undefined'||Notification.permission!=='granted') return;
  const[h,mn]=notifSettings.time.split(':').map(Number);
  const now=new Date(),target=new Date();
  target.setHours(h,mn,0,0);
  if(target<=now) target.setDate(target.getDate()+1);
  setTimeout(()=>{
    new Notification('ğŸ‹ï¸ Habit Tracker',{body:"Time to log today's habits!",icon:'icon.png'});
    scheduleNotification();
  },target-now);
}
if(notifSettings.enabled) scheduleNotification();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WORKOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DAY_ORDER=[1,2,3,4,5,6,0];
function buildWorkoutView(){
  const tabBar=document.getElementById('day-tab-bar');
  const content=document.getElementById('workout-content');
  tabBar.innerHTML=''; content.innerHTML='';
  DAY_ORDER.forEach(dow=>{
    const tab=document.createElement('div');
    tab.className='day-tab'+(dow===todayDow?' active today-tab':'');
    tab.id=`tab-${dow}`; tab.textContent=DFULL[dow].slice(0,3).toUpperCase();
    tab.onclick=()=>activateWorkoutDay(dow);
    tabBar.appendChild(tab);
    const panel=document.createElement('div');
    panel.className='workout-day-panel'+(dow===todayDow?' active':'');
    panel.id=`panel-${dow}`;
    content.appendChild(panel);
    renderWorkoutDay(dow);
  });
}
function activateWorkoutDay(dow){
  document.querySelectorAll('.day-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.workout-day-panel').forEach(p=>p.classList.remove('active'));
  document.getElementById(`tab-${dow}`).classList.add('active');
  document.getElementById(`panel-${dow}`).classList.add('active');
}
function renderWorkoutDay(dow){
  const panel=document.getElementById(`panel-${dow}`);
  if(!panel) return;
  const dd=workoutData[dow]||(workoutData[dow]={rest:false,exercises:[]});
  const done=dd.exercises.filter(e=>e.done).length;
  const total=dd.exercises.length;
  panel.innerHTML=`
    <div class="wday-title">${DFULL[dow]}</div>
    <div class="wday-sub">${dow===todayDow?'Today Â· ':''}${total>0?done+'/'+total+' done':'No exercises yet'}</div>
    <div class="rest-toggle${dd.rest?' rest':''}" id="rest-${dow}" onclick="toggleRest(${dow})">${dd.rest?'ğŸ˜´ Rest Day â€” tap to change':'ğŸƒ Training Day â€” tap to mark as rest'}</div>
    ${!dd.rest?`
      <div class="ex-list" id="exlist-${dow}"></div>
      <div class="add-ex-row">
        <input class="ex-input" id="ex-input-${dow}" placeholder="e.g. Push-ups 3Ã—12" onkeydown="if(event.key==='Enter')addEx(${dow})">
        <button class="btn btn-accent" style="padding:9px 14px" onclick="addEx(${dow})">+</button>
      </div>
      <button class="clear-done-btn" onclick="clearDoneEx(${dow})">Clear Completed</button>
    `:''}`;
  if(!dd.rest) renderExList(dow);
}
function renderExList(dow){
  const el=document.getElementById(`exlist-${dow}`); if(!el) return;
  const exercises=workoutData[dow]?.exercises||[];
  if(!exercises.length){el.innerHTML=`<div class="empty-state"><div class="empty-icon">ğŸ‹ï¸</div>Add your first exercise below</div>`;return;}
  el.innerHTML='';
  exercises.forEach((ex,i)=>{
    const item=document.createElement('div');
    item.className='ex-item'+(ex.done?' done-item':'');
    item.innerHTML=`<div class="ex-check${ex.done?' done':''}" onclick="toggleEx(${dow},${i})">${ex.done?'âœ“':''}</div><div class="ex-body"><div class="ex-name${ex.done?' done-text':''}">${esc(ex.name)}</div>${ex.detail?`<div class="ex-detail">${esc(ex.detail)}</div>`:''}</div><div class="ex-del" onclick="delEx(${dow},${i})">Ã—</div>`;
    el.appendChild(item);
  });
}
function addEx(dow){
  const inp=document.getElementById(`ex-input-${dow}`);
  const val=inp.value.trim(); if(!val) return;
  if(!workoutData[dow]) workoutData[dow]={rest:false,exercises:[]};
  workoutData[dow].exercises.push({name:val,done:false});
  saveW(); inp.value=''; renderWorkoutDay(dow);
}
function toggleEx(dow,i){workoutData[dow].exercises[i].done=!workoutData[dow].exercises[i].done;saveW();renderWorkoutDay(dow);}
function delEx(dow,i){workoutData[dow].exercises.splice(i,1);saveW();renderWorkoutDay(dow);}
function clearDoneEx(dow){if(workoutData[dow])workoutData[dow].exercises=workoutData[dow].exercises.filter(e=>!e.done);saveW();renderWorkoutDay(dow);}
function toggleRest(dow){if(!workoutData[dow])workoutData[dow]={rest:false,exercises:[]};workoutData[dow].rest=!workoutData[dow].rest;saveW();renderWorkoutDay(dow);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SKILLS â€” 3-MONTH PERIODS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Periods start from Jun 2026: Jun-Aug, Sep-Nov, Dec-Feb, Mar-May, repeat
const PERIOD_STARTS=[]; // generate 20 periods
(function(){
  let d=new Date(2026,5,1); // June 2026
  for(let i=0;i<24;i++){
    const start=new Date(d);
    const end=new Date(d); end.setMonth(end.getMonth()+3); end.setDate(end.getDate()-1);
    PERIOD_STARTS.push({start,end,id:`${start.getFullYear()}-${start.getMonth()}`});
    d.setMonth(d.getMonth()+3);
  }
})();

function getCurrentPeriodIdx(){
  for(let i=0;i<PERIOD_STARTS.length;i++){
    const{start,end}=PERIOD_STARTS[i];
    if(today>=start&&today<=end) return i;
  }
  return 0;
}

let activePeriodIdx=getCurrentPeriodIdx();

function periodLabel(p){
  return `${MSHORT[p.start.getMonth()]} â€“ ${MSHORT[p.end.getMonth()]} ${p.end.getFullYear()}`;
}

function daysLeftInPeriod(p){
  const diff=Math.ceil((p.end-today)/(1000*60*60*24));
  return Math.max(0,diff);
}

function buildSkillsView(){
  // Period chips
  const scroll=document.getElementById('period-scroll');
  scroll.innerHTML='';
  const curIdx=getCurrentPeriodIdx();
  PERIOD_STARTS.forEach((p,i)=>{
    const chip=document.createElement('div');
    chip.className='period-chip'+(i===activePeriodIdx?' active':'')+(i===curIdx?' current-period':'');
    chip.textContent=periodLabel(p)+(i===curIdx?' â—':'');
    chip.onclick=()=>{activePeriodIdx=i;buildSkillsView();};
    scroll.appendChild(chip);
  });
  renderPeriodPanel();
}

function renderPeriodPanel(){
  const panel=document.getElementById('period-panel');
  const p=PERIOD_STARTS[activePeriodIdx];
  const pid=p.id;
  const curIdx=getCurrentPeriodIdx();
  const isCurrent=activePeriodIdx===curIdx;
  const isPast=activePeriodIdx<curIdx;
  const skills=(skillsData[pid]||{skills:[]}).skills;

  // Period progress
  let periodFill=0;
  if(isCurrent){
    const total=Math.ceil((p.end-p.start)/(1000*60*60*24));
    const elapsed=Math.ceil((today-p.start)/(1000*60*60*24));
    periodFill=Math.min(100,Math.round(elapsed/total*100));
  } else if(isPast){ periodFill=100; }

  // Skill completion
  let totalSubtasks=0,doneSub=0;
  skills.forEach(sk=>{
    if(sk.done){doneSub+=1;totalSubtasks+=1;}
    else{totalSubtasks+=1;}
    (sk.subtasks||[]).forEach(st=>{totalSubtasks++;if(st.done)doneSub++;});
  });
  const skillPct=totalSubtasks>0?Math.round(doneSub/totalSubtasks*100):0;

  panel.innerHTML=`
    <div class="period-hero">
      <div class="period-hero-header">
        <div>
          <div class="period-hero-title">${isCurrent?'Current Sprint':'Sprint'} ${activePeriodIdx+1}</div>
          <div class="period-hero-dates">${p.start.toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'})} â†’ ${p.end.toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'})}</div>
        </div>
        <div class="period-hero-right">
          <div class="period-pct">${skillPct}%</div>
          <div class="period-days-left">${isCurrent?daysLeftInPeriod(p)+' days left':isPast?'Completed':'Upcoming'}</div>
        </div>
      </div>
      <div class="period-progress"><div class="period-fill" style="width:${periodFill}%"></div></div>
    </div>

    ${isCurrent||!isPast?`
    <div class="section-title">Skills to Learn</div>
    <div class="add-skill-row">
      <input class="skill-main-input" id="skill-input-${pid}" placeholder="e.g. JavaScript, Piano, Spanish..." onkeydown="if(event.key==='Enter')addSkill('${pid}')">
      <button class="btn btn-accent" style="padding:10px 14px" onclick="addSkill('${pid}')">+</button>
    </div>
    `:'<div class="section-title">Skills Learned</div>'}

    <div id="skills-list-${pid}"></div>
  `;
  renderSkillsList(pid);
}

function renderSkillsList(pid){
  const container=document.getElementById(`skills-list-${pid}`); if(!container) return;
  const skills=(skillsData[pid]||{skills:[]}).skills;
  container.innerHTML='';
  if(!skills.length){
    container.innerHTML=`<div class="empty-state"><div class="empty-icon">ğŸ§ </div>No skills added yet.<br>Add a skill you want to master this 3-month sprint.</div>`;
    return;
  }
  skills.forEach((sk,si)=>{
    const card=document.createElement('div');
    card.className='skill-card';
    const subtasks=sk.subtasks||[];
    const doneSub=subtasks.filter(s=>s.done).length;
    const expanded=sk._expanded||false;
    card.innerHTML=`
      <div class="skill-card-header" onclick="toggleSkillExpand('${pid}',${si})">
        <div class="skill-card-check${sk.done?' done':''}" onclick="event.stopPropagation();toggleSkill('${pid}',${si})">${sk.done?'âœ“':''}</div>
        <div class="skill-card-info">
          <div class="skill-card-name${sk.done?' done-text':''}">${esc(sk.name)}</div>
          <div class="skill-card-meta">${subtasks.length?doneSub+'/'+subtasks.length+' tasks':'No tasks yet â€” tap to add'}</div>
        </div>
        <div class="skill-card-right">
          <div class="skill-del" onclick="event.stopPropagation();delSkill('${pid}',${si})">Ã—</div>
          <div class="skill-expand${expanded?' open':''}">â–¾</div>
        </div>
      </div>
      <div class="subtask-section${expanded?' open':''}" id="subtasks-${pid}-${si}">
        <div class="subtask-list" id="stlist-${pid}-${si}"></div>
        <div class="add-subtask-row">
          <input class="st-input" id="st-input-${pid}-${si}" placeholder="Add a task or milestone..." onkeydown="if(event.key==='Enter')addSubtask('${pid}',${si})">
          <button class="st-add-btn" onclick="addSubtask('${pid}',${si})">+</button>
        </div>
      </div>
    `;
    container.appendChild(card);
    renderSubtasks(pid,si);
  });
}

function renderSubtasks(pid,si){
  const el=document.getElementById(`stlist-${pid}-${si}`); if(!el) return;
  const subtasks=((skillsData[pid]||{}).skills||[])[si]?.subtasks||[];
  el.innerHTML='';
  subtasks.forEach((st,ti)=>{
    el.innerHTML+=`<div class="subtask-item"><div class="st-check${st.done?' done':''}" onclick="toggleSubtask('${pid}',${si},${ti})">${st.done?'âœ“':''}</div><div class="st-text${st.done?' done-text':''}">${esc(st.text)}</div><div class="st-del" onclick="delSubtask('${pid}',${si},${ti})">Ã—</div></div>`;
  });
}

function addSkill(pid){
  const inp=document.getElementById(`skill-input-${pid}`);
  const val=inp.value.trim(); if(!val) return;
  if(!skillsData[pid]) skillsData[pid]={skills:[]};
  skillsData[pid].skills.push({name:val,done:false,subtasks:[],_expanded:true});
  saveS(); inp.value=''; renderSkillsList(pid);
}
function delSkill(pid,si){skillsData[pid].skills.splice(si,1);saveS();renderSkillsList(pid);}
function toggleSkill(pid,si){
  const sk=skillsData[pid].skills[si];
  sk.done=!sk.done;
  saveS(); renderSkillsList(pid);
}
function toggleSkillExpand(pid,si){
  const sk=skillsData[pid].skills[si];
  sk._expanded=!sk._expanded;
  saveS(); renderSkillsList(pid);
}
function addSubtask(pid,si){
  const inp=document.getElementById(`st-input-${pid}-${si}`);
  const val=inp.value.trim(); if(!val) return;
  const sk=skillsData[pid].skills[si];
  if(!sk.subtasks) sk.subtasks=[];
  sk.subtasks.push({text:val,done:false});
  saveS(); inp.value=''; renderSkillsList(pid);
}
function toggleSubtask(pid,si,ti){skillsData[pid].skills[si].subtasks[ti].done=!skillsData[pid].skills[si].subtasks[ti].done;saveS();renderSubtasks(pid,si);renderSkillsList(pid);}
function delSubtask(pid,si,ti){skillsData[pid].skills[si].subtasks.splice(ti,1);saveS();renderSkillsList(pid);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW SWITCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchView(v){
  document.querySelectorAll('.view').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(el=>el.classList.remove('active'));
  document.getElementById(`view-${v}`).classList.add('active');
  document.getElementById(`nav-${v}`).classList.add('active');
  if(v==='stats') renderStatsView();
  if(v==='workout') buildWorkoutView();
  if(v==='skills') buildSkillsView();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(()=>{});
</script>
</body>
</html>
